# 静的ビルド／ホスティング戦略メモ

## 目的

`victory-counter-overlay-ui` を配信者が簡単に利用できるよう、Node の開発サーバに依存しない形で配信用オーバーレイを提供する。

## 現状

dev サーバ (`npm run dev`) を起動し、配信者が管理 UI を操作し、ブラウザソースには Python の `/overlay` を利用する構成になっている。
ただし、最終的には配信者に静的ファイルを提供し、オフラインでも読めるようにしたい。

## 選択肢

1. **Vite + React (静的ビルド)**

   - `npm run build` で `dist` ディレクトリに静的ファイルを生成。
   - OBS ブラウザソースで `file://` もしくは軽量ローカルサーバ（`python -m http.server`）で配信。
   - Pros: モダンなツール。管理 UI と共通コンポーネントを利用できる。
   - Cons: バンドルサイズが大きくなりやすい。配信者にはビルド済みアセットを配布する必要がある。

2. **Vanilla JS + Rollup/Vite Lite**

   - 配信用オーバーレイのみを抽出した、より軽量な静的ファイルを生成。
   - Pros: `/overlay` に近い簡素な構造にできる。
   - Cons: 管理 UI との共有が減り、開発コストが分散する。

3. **Python 側の `/overlay` を強化する**
   - 現在の `/overlay` を主たる配信オーバーレイとして採用し、HTML にカスタマイズ機能を徐々に追加。
   - Pros: エンドユーザーはOBSにURLを指定するだけでよい。
   - Cons: モダンなUIを実装するにはPython側での開発が必要。管理UIとの共通化が難しい。

## 推奨案

- フェーズ7では短期的に `/overlay` を配信向けとして改善しつつ、`victory-counter-overlay-ui` に静的ビルド環境を整備し、後でリリースモードを用意する。
- 手順案:
  1. Vite (もしくは適切なバンドラー) を導入し、`npm run build` で `dist/overlay` を生成する。
  2. ビルドされたHTML内で `/state` `/history` API をポーリングする（現状の `/overlay` と同様）。
  3. エンドユーザーは `dist/overlay/index.html` をOBSブラウザソースに指定する、あるいは軽量な`npm run static`コマンドで提供する。
  4. 管理 UI と配信用オーバーレイを同じプロジェクトに含めつつ、ビルド時のエントリを分ける。

## 残課題

- 管理UIと配信用オーバーレイのコンポーネント共有の設計。
- `docs/specs/obs_integration.md` に静的ファイル利用手順を追記する。
- CI 側で `npm run build` を確認し、配布方法（GitHub Releases 等）を検討する。
