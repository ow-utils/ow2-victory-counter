# 画像解析 PoC 計画メモ

## 目的

Victory / Defeat / Draw のバナーを自動検出する手法を調査・試作し、フェーズ8以降で本実装へ繋げるための段取りを整理する。

## 想定シナリオ

1. OBS から取得したキャプチャ画像（スクリーンショット or フレーム単位）を解析し、勝敗バナー／UI 要素を検出する。
2. 判定結果を現行の `StateManager` に渡し、イベントログ・配信用オーバーレイと連携する。

## 技術候補

| 手法                              | 概要                               | Pros                       | Cons                                               |
| --------------------------------- | ---------------------------------- | -------------------------- | -------------------------------------------------- |
| テンプレートマッチング (OpenCV)   | 既知のバナー画像とキャプチャを照合 | 実装容易、リアルタイム向き | 配色変更への追随が難しい、スケール調整が必要       |
| カラーヒストグラム + ルールベース | バナー領域の色相・輝度で判定       | 背景色が一定なら実装が簡単 | カスタムテーマや色覚フィルタで崩れやすい           |
| OCR + テキスト検出                | 「VICTORY」「DEFEAT」文字列を抽出  | 言語設定に依存しにくい     | 日本語 UI では別テキストになる可能性、誤検出が多い |
| ML モデル（YOLO, TensorFlow）     | 事前学習モデルでバナー領域を検出   | 汎用性と拡張性が高い       | データ収集・学習コストが高い、PoCには重い          |

## PoC 方針案

1. **ステップA**: テンプレートマッチング + 輝度調整の PoC を実施し、Victory/Defeat バナーを最小限で検出できるか確認する。
2. **ステップB**: Draw バナーや他言語 UI も含め、複数テンプレート／閾値調整が必要か評価する。
3. **ステップC**: 必要に応じて OCR や ML ベース手法を比較・導入する。

## データセットの準備

- キャプチャ方法: OBS で Victory/Defeat/Draw のスクリーンショットを取得し、`data/samples/` に格納（Git LFS or 外部ストレージを利用）。
- メタ情報: JSON でラベリング (`{ "file": "victory_01.png", "label": "victory", "notes": "default theme" }`)。
- バリエーション: カラーテーマ変更、解像度、UI 言語（英語/日本語）ごとの収集。

## タスク一覧

1. キャプチャ画像の収集とラベリングルールの定義。
2. テンプレート画像の抽出（Victory/Defeat/Draw バナーの切り抜き）。
3. PoC スクリプトの作成 (`python scripts/poc_detect.py` など) と精度評価。
4. 結果を `docs/specs/architecture.md` または専用ドキュメントに反映し、今後の実装方針を決定。

## 成果物

- PoC 実行スクリプト＋サンプル結果（検出可否、誤判定率）。
- 画像データ保管方法、セキュリティ上の注意点（配信映像が含まれる場合の取り扱い）。
- 本実装に向けたステップ（ライブラリ決定、API 変更点、テスト方針）。
