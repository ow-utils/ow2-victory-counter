# フェーズ7 TODO 総覧

## 完了済みマイルストーン

- [x] Victory/Defeat/Draw データモデル拡張と API/UI の更新
- [x] 配信用 `/overlay` エンドポイントとオーバーレイ UI の整備
- [x] テンプレートマッチング PoC（スコア分布の把握と閾値策定）
- [x] `scripts/check_templates.py` によるテンプレート整合性チェック
- [x] obs-websocket(5.x) 経由でのスクリーンショット取得 PoC

## 進行中タスク

### 画像解析 (CNN 化)
- [ ] `scripts/build_dataset.py` を用いた `victory/defeat/draw/none` データセットの整備（none クラスの収集含む）。従来の JSON ベースに加え、`samples/<label>/` フォルダに直接 PNG を配置する簡易構造にも対応
- [ ] `scripts/train_classifier.py` で軽量 CNN を学習し、精度・推論時間を評価
- [ ] 学習済みモデルを `run_capture_monitor_ws.py` に統合し、テンプレート照合から置き換え
- [ ] Victory Detector への自動反映（`/adjust` POST）の実装とログ検証

### OBS 連携・運用
- [ ] websocket 監視スクリプトの設定ファイル化（variant ごとの `template_bbox` / モデル指定）
- [ ] キャプチャ間隔を 0.3s 前後に設定した長時間テストと負荷計測
- [ ] 誤判定時のリトライ／エラーログ整理

### 静的ビルド・CI
- [ ] `victory-counter-overlay-ui` の静的ビルドと管理 UI のコンポーネント共有計画
- [ ] Python/Node の lint/test/build を GitHub Actions で自動化
- [ ] モデル学習・テンプレート生成の CI 手順（少なくともフォーマットチェック、テンプレート整合性チェック）

### ドキュメント整備
- [ ] CNN 学習・推論手順を `docs/specs/architecture.md` などに追記
- [ ] ユーザー向けセットアップ手順（obs-websocket 設定 / キャプチャソース選択 / CNN 導入手順）の整備

## バックログ

- [ ] ライバル以外のモード・他言語 UI のスクリーンショット収集と `template_bbox` 整備
- [ ] 勝敗判定が不確実な場合のフォールバック（テンプレート照合とのハイブリッド等）
- [ ] 学習データの共有方法（LFS or 外部ストレージ）とバージョン管理方針
- [ ] 推論モデルの軽量化・最適化（ONNX、量子化など）

---

このファイルを単一の TODO とし、タスクの状態更新や追記は本ドキュメントに反映する。

## 参考メモ（データ収集・ラベリング）

- スクリーンショットは OBS で勝敗画面が表示されたタイミングを保存し、`data/samples/YYYYMMDD_runXX/` に配置する。JSON メタデータには `label`, `variant`（アクセシビリティ／モード、テンプレート生成に使用），`template_bbox`（`[x, y, width, height]`）を記録する。なお、CNN データセット構築では `variant` は不要で、`samples/<label>/*.png` という簡易構造にも対応している。
- ラベルは `victory`, `defeat`, `draw`, `none`（勝敗バナーが出ていないシーン）を基本とし、品質が低い場合は `"quality": "low"` などのフラグを付け、PoC 学習から除外できるようにする。
- 追加で収集したサンプルは `scripts/export_templates.py` → `scripts/build_dataset.py` の順でテンプレート／学習データに反映し、必要に応じて `scripts/train_classifier.py` でモデルを再学習する。簡易なデータセット構築には、`samples/victory/`, `samples/defeat/` などのフォルダに直接 PNG を配置する方法も利用できる。
