# フェーズ7移行前の準備タスク

## 目的

フェーズ7（最終調整と CI 整備）に入る前に、残作業を整理し、優先度と担当を明確化する。

## 優先タスク

1. **画像解析ロジックの立案**

   - Victory/Defeat/Draw を自動検出するためのテンプレートマッチング、OCR、色空間変換などの候補技術を比較する。
   - オーバーレイに渡すスナップショット形式と更新周期を決定する。
   - 検証用にキャプチャ画像サンプルを収集し、ラベリング方法を決める。

2. **引き分け（Draw）対応計画**

   - データモデル（イベントログ、API、UI）で draw を扱うためのフィールド拡張と互換性確認。
   - 手動補正フォーム、サーバテストの修正範囲を洗い出す。

3. **静的配信用ビルド戦略の検討**

   - `victory-counter-overlay-ui` のビルド/ホスティング方法を決める（Vite などの導入可否）。
   - OBS での自前ホスティングとローカルファイル読み込みの比較検討。

4. **CI パイプライン草案**
   - Python/Node 双方の lint/test を GitHub Actions で走らせるジョブ設計。
   - 画像解析が入る場合のテストデータ管理とキャッシュ戦略を定義する。

## 補足メモ

- `docs/specs/api.md` と `docs/specs/obs_integration.md` を随時更新し、仕様変更が発生したら即座に反映する。
- キャプチャ画像のサンプルはリポジトリへ直接コミットせず、参照先の共有方法（Git LFS、外部ストレージ）を決める。
- 今後作成する計画ドキュメントは、このファイル命名規則（`YYYY-MM-DD-XXタイトル.md`）を遵守する。

## 初期構想（クローズ済み）

- ２つの成果物：Victory Detector (Python) / Victory Counter Overlay UI (HTML/JS)
- モノレポ構成で親 README に全体像、各プロジェクトの README に詳細を記載。
- Victory Detector は OBS の Python スクリプトとして実装し、見通しとして OpenCV などの画像処理を予定。
- 判定ロジックはテンプレートマッチング＋色抽出ベースを検討し、イベントログに勝敗・補正結果を記録。
- HTTP サーバ (`/state`, `/history`, `/adjust`) を立ち上げ、UI からは定期 `fetch` で勝敗を取得。
- 将来的に WebSocket や認証、ローカル以外での配信手段（静的ホスティング等）を拡張対象にする。

## 実装フェーズ TODO（クローズ済み）

- フェーズ1～6 までは全て完了。主な内容:
  - 勝敗判定ロジック (スタブ)・イベントログ・CLI・HTTP API・モック UI・OBS 連携まで整備。
  - `/state` ポーリング、`POST /adjust` の手動補正、CORS 対応を済ませ、OBS ブラウザソースで動作確認済み。
- フェーズ7 の準備として以下を保持:
  - 自動画像解析ロジックの導入計画・Draw 対応・静的ビルド・CI 整備。
