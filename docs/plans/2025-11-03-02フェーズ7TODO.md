# フェーズ7 TODO

## フェーズ7-A: Draw 対応の設計と実装

- [x] Victory/Defeat/Draw を扱えるデータモデル案を作成する（イベントログ・`CounterState`・API レスポンス）。
- [x] `/adjust` と手動補正フォームで draw を扱う UI/テストの影響範囲を棚卸しする。
- [x] サーバ・UI のユニットテストに draw ケースを追加する。
- [x] 仕様変更が決まったら `docs/specs/api.md` を更新する。

## フェーズ7-B: 配信オーバーレイ専用エンドポイント

- [x] 新エンドポイント（例: `/overlay`）のペイロードと HTTP インターフェースを設計する。
- [x] レイアウトのカスタマイズ手段（クエリ／設定ファイル）と既存 UI の役割分担を整理する。
- [ ] オーバーレイ専用 UI を実装し、OBS ブラウザソースで表示を確認する。
- [x] エンドユーザーが CSS でカスタマイズしやすいよう、クラス名・構造の指針を整理する。

## フェーズ7-C: 画像解析ロジック PoC

- [x] Victory/Defeat/Draw を検出する候補技術（テンプレートマッチング／OCR／色判定）を比較する。
- [x] キャプチャ画像サンプルを収集し、ラベリングルールと保管方針を決める（詳細は `docs/plans/2025-11-03-07画像サンプル収集手順.md` を参照）。
- [x] Victory/Defeat/Draw のテンプレート画像を切り出し、共有ストレージへ保存する。
- [x] PoC で取得したスコア分布を集計し、閾値の推奨値と警戒ライン（unknown 判定ルール）を決める。
- [x] モード／アクセシビリティごとのテンプレート不足や不一致を検知するためのチェックロジックを設計する。
- [x] `scripts/poc_detect.py` を用いてテンプレートマッチングの精度を評価し、閾値と更新周期の目安をまとめる。
- [x] PoC の結果と次の実装ステップを `docs/specs/architecture.md` に追記する。
- [ ] CNN 用データセットを `scripts/build_dataset.py` で構築し、`victory/defeat/draw/none` クラスを揃える。
- [ ] `scripts/train_classifier.py` で軽量 CNN を学習し、精度・推論時間を評価する。
- [ ] 学習済みモデルを webhook 監視スクリプトへ統合し、テンプレート照合から置き換える。

## フェーズ7-D: 静的ビルド／ホスティング戦略

- [x] `victory-counter-overlay-ui` の静的ビルド手段（Vite 等）を検討し、試作を行う。
- [x] OBS での利用方法（ローカルファイル／軽量サーバ）ごとの利点と注意点を比較する。
- [x] 手順が固まったら `docs/specs/obs_integration.md` に反映する。
- [ ] 管理 UI と配信用オーバーレイのコンポーネント共有方法を整理し、リファクタリング計画を作成する。
- [ ] 静的ビルド成果物の配布フロー（アーカイブ生成・配布媒体）を決める。

## フェーズ7-E: CI パイプライン整備

- [ ] Python/Node 双方の lint/test/build を GitHub Actions で実行するワークフロー案を作る。
- [ ] 画像解析テストが入る場合のデータ管理・キャッシュ戦略を整理する。
- [ ] CI 導入後の運用ルールを `docs/specs/obs_integration.md` に追記する。
- [ ] `victory-counter-overlay-ui` の `npm run package-overlay` を CI に組み込む可否を検討し、成果物配布の仕組みを提案する。

## フェーズ7-F: ドキュメント整備

- [ ] 各フェーズで仕様変更があった場合、即 `docs/specs/api.md`／`docs/specs/obs_integration.md` を更新する運用を徹底する。
- [ ] 今後の計画ドキュメントは `docs/plans` の命名規則（`YYYY-MM-DD-XXタイトル.md`）に従うことを再確認する。
